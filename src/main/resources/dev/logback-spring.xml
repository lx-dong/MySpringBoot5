<?xml version="1.0" encoding="UTF-8"?>
<configuration scan="true" scanPeriod="60000" debug="false" >
       <include resource="org/springframework/boot/logging/logback/defaults.xml" />
       <include resource="org/springframework/boot/logging/logback/console-appender.xml" />
       <!-- 日志文件名 及 路径 -->
       <property name="LOG_FILE" value="${LOG_FILE:-${LOG_PATH:-${LOG_TEMP:-${java.io.tmpdir:-/tmp}}/}spring.log}"/>

       <property name="smtpHost" value="mail.china317.com"/>
       <property name="smtpPort" value="25" />
       <property name="username" value="gislog" />
       <property name="password" value="gislog123" />
       <property name="SSL" value="false" />
       <property name="email_to" value="lingxu.dong@china317.com" />
       <property name="email_from" value="gislog@china317.com" />
       <property name="email_subject" value="[spring-boot5]errorMessage: %logger" />

       <!-- 每天生成一个日志文件 -->
       <appender name="rolling_file" class="ch.qos.logback.core.rolling.RollingFileAppender">
              <file>${LOG_FILE}</file>
              <encoder>
                     <pattern>${FILE_LOG_PATTERN}</pattern>
              </encoder>
              <rollingPolicy class="ch.qos.logback.core.rolling.TimeBasedRollingPolicy">
                     <fileNamePattern>${LOG_FILE}.%d{yyyy-MM-dd}</fileNamePattern>
              </rollingPolicy>
       </appender>

       <!-- 邮件配置 -->
       <appender name="EMAIL" class="ch.qos.logback.classic.net.SMTPAppender">
              <smtpHost>ADDRESS-OF-YOUR-SMTP-HOST</smtpHost>
              <to>EMAIL-DESTINATION</to>
              <to>ANOTHER_EMAIL_DESTINATION</to> <!-- additional destinations are possible -->
              <from>SENDER-EMAIL</from>
              <subject>TESTING: %logger{20} - %m</subject>
              <layout class="ch.qos.logback.classic.PatternLayout">
                     <pattern>%date %-5level %logger{35} - %message%n</pattern>
              </layout>
       </appender>
       <appender name="EMAIL" class="ch.qos.logback.classic.net.SMTPAppender">
              <smtpHost>${smtpHost}</smtpHost>
              <!--<smtpPort>${smtpPort}</smtpPort>-->
              <username>${username}</username>
              <password>${password}</password>
              <SSL>${SSL}</SSL>
              <asynchronousSending>false</asynchronousSending>
              <to>${email_to}</to>
              <from>${email_from}</from>
              <subject>${email_subject}</subject>
              <layout class="ch.qos.logback.classic.html.HTMLLayout" >
                     <pattern>%date%level%thread%logger{0}%line%message</pattern>
              </layout>
              <filter class="ch.qos.logback.core.filter.EvaluatorFilter">
                     <evaluator class="ch.qos.logback.classic.boolex.JaninoEventEvaluator">
                            <expression>
                                   <!-- & encoded as &amp; -->
                                   if(level > WARN &amp;&amp; null != throwable) {
                                   return true;
                                   }
                                   return false;
                            </expression>
                     </evaluator>
                     <onMatch>ACCEPT</onMatch>
                     <onMismatch>DENY</onMismatch>
              </filter>
       </appender>

       <!-- 精确到包/类 日志控制-->
       <logger name="com.china317.myspringboot5" level="DEBUG" />

       <!--log4jdbc -->
       <logger name="jdbc.sqltiming" level="DEBUG"/>
       <!--<logger name="org.hibernate.type.descriptor.sql.BasicBinder" level="TRACE"/>
       <logger name="org.hibernate.type.descriptor.sql.BasicExtractor" level="TRACE"/>-->
       <logger name="org.hibernate.SQL" level="DEBUG"/>
       <logger name="org.hibernate.engine.QueryParameters" level="DEBUG"/>
       <logger name="org.hibernate.engine.query.HQLQueryPlan" level="DEBUG"/>

       <!-- 只输出控制台日志。additivity 定义日志是否向上传递，true 会有重复日志产生 -->
       <logger name="com.china317.myspringboot5.test" level="DEBUG" additivity="false">
              <appender-ref ref="CONSOLE" />
       </logger>

       <root level="INFO">
              <appender-ref ref="CONSOLE" />
              <appender-ref ref="rolling_file" />
             <!-- <appender-ref ref="EMAIL"/>-->
       </root>
</configuration>